<!DOCTYPE html>
<html>
<head>
    <title>Anshubot Dashboard</title>
    <style>
        /* ... existing styles ... */
        .photo-upload-section {
            margin: 20px 0;
        }
        .relationship-mapping {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #eee;
        }
        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .preview-item {
            position: relative;
            padding: 5px;
        }
        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .face-tag {
            position: absolute;
            background: rgba(255,255,255,0.8);
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Anshubot Dashboard</h1>
    
    <div class="control-panel">
        <h2>Photo Management</h2>
        
        <!-- Relationship Definitions -->
        <div class="relationship-mapping">
            <h3>Define Relationships</h3>
            <div>
                <label>Anshul:</label>
                <input type="text" id="anshul-relation" value="boyfriend" placeholder="e.g., boyfriend">
            </div>
            <div>
                <label>Aarya:</label>
                <input type="text" id="aarya-relation" value="me" placeholder="e.g., me">
            </div>
        </div>

        <!-- Photo Upload -->
        <div class="photo-upload-section">
            <h3>Upload Photos</h3>
            <input type="file" id="photoUpload" accept="image/*" multiple>
            <p class="help">Select multiple photos of you and Anshul</p>
        </div>

        <!-- Preview Section -->
        <div id="previewContainer" class="preview-container"></div>

        <button onclick="processPhotos()">Process Photos</button>
        <div id="uploadStatus" class="upload-status"></div>
    </div>

    <script>
        let processedPhotos = [];

        async function processPhotos() {
            const files = document.getElementById('photoUpload').files;
            const anshulRelation = document.getElementById('anshul-relation').value;
            const aaryaRelation = document.getElementById('aarya-relation').value;
            
            try {
                updateStatus('Processing photos...', 'info');
                
                for(let file of files) {
                    const photoData = await processPhoto(file);
                    processedPhotos.push({
                        file: file.name,
                        faces: photoData.faces,
                        relationships: {
                            'Anshul': anshulRelation,
                            'Aarya': aaryaRelation
                        }
                    });
                }

                // Send to GitHub Actions
                const response = await fetch('https://api.github.com/repos/YOUR_USERNAME/YOUR_REPO/dispatches', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${process.env.GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        event_type: 'process_photos',
                        client_payload: {
                            photos: processedPhotos
                        }
                    })
                });
                
                updateStatus('Photos processed and uploaded successfully!', 'success');
            } catch (error) {
                updateStatus('Processing failed: ' + error.message, 'error');
            }
        }

        async function processPhoto(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        // Preview the image
                        showPreview(img.src, file.name);
                        
                        // In real implementation, we'd do face detection here
                        resolve({
                            width: img.width,
                            height: img.height,
                            faces: [] // Will be populated by Azure Face API
                        });
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        function showPreview(src, filename) {
            const container = document.getElementById('previewContainer');
            const div = document.createElement('div');
            div.className = 'preview-item';
            div.innerHTML = `
                <img src="${src}" alt="${filename}">
                <div class="face-tag">Processing...</div>
            `;
            container.appendChild(div);
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.textContent = message;
            statusDiv.className = `upload-status ${type}`;
            statusDiv.style.display = 'block';
        }
    </script>
</body>
</html>
